[
 {
  "docstatus": 0,
  "doctype": "Custom HTML Block",
  "html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>MediaOne Employee Dashboard</title>\n  <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css\">\n  <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\n</head>\n<body style=\"padding: 2rem;\">\n\n  <div class=\"mb-4 text-center\">\n    <h2 class=\"font-weight-bold text-uppercase\" style=\"letter-spacing: 1px; color: #000;\">\n      <i class=\"fa fa-users\"></i> MEDIAONE EMPLOYEE\n    </h2>\n    <hr style=\"border-top: 2px solid #999; width: 60px; margin: 0.5rem auto;\">\n  </div>\n\n  <!-- Employee Section -->\n  <div class=\"mb-4\">\n    <div class=\"card shadow-sm p-3 h-100\">\n      <div class=\"d-flex align-items-center mb-3\">\n        <h4 class=\"ms-2 mb-0\"><i class=\"fa fa-briefcase me-2\"></i> Employees by Department</h4>\n      </div>\n      <div id=\"employee-wrapper\" style=\"max-height: 600px; overflow-y: auto;\">\n        <div id=\"employee-content\" class=\"list-group\">\n          <p class=\"text-muted\">Loading all employees...</p>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <!-- Quick Links Section -->\n  <div class=\"mb-4\">\n    <div class=\"card shadow-sm p-3\">\n      <div class=\"d-flex align-items-center mb-3\">\n        <h4 class=\"ms-2 mb-0\">Quick Links</h4>\n      </div>\n      <ul class=\"list-group list-group-flush\">\n        <li class=\"list-group-item\"><a href=\"/app/leave-application\"><i class=\"fa fa-calendar\"></i> Apply Leave</a></li>\n        <li class=\"list-group-item\"><a href=\"/app/attendance\"><i class=\"fa fa-clock-o\"></i> My Attendance</a></li>\n        <li class=\"list-group-item\"><a href=\"/app/salary-slip\"><i class=\"fa fa-money\"></i> Salary Slip</a></li>\n      </ul>\n    </div>\n  </div>\n\n</body>\n</html>",
  "modified": "2025-07-16 11:40:27.419004",
  "name": "Employee View",
  "private": 0,
  "roles": [],
  "script": "frappe.after_ajax(() => {\n  const container = root_element.querySelector(\"#employee-content\");\n  container.innerHTML = `<p class=\"text-muted\">Loading all employees...</p>`;\n\n  frappe.call({\n    method: \"frappe.client.get_list\",\n    args: {\n      doctype: \"Employee\",\n      fields: [\n        \"name\",\n        \"employee_name\",\n        \"designation\",\n        \"status\",\n        \"department\",\n        \"date_of_joining\",\n        \"image\"\n      ],\n      order_by: \"modified DESC\", // fallback ordering\n      limit_page_length: 500\n    },\n    callback: function (res) {\n      const employees = res.message || [];\n      container.innerHTML = \"\";\n\n      if (employees.length === 0) {\n        container.innerHTML = `<p class=\"text-muted\">No employees found.</p>`;\n        return;\n      }\n\n      // Group employees by department\n      const grouped = {};\n      employees.forEach(emp => {\n        if (!grouped[emp.department]) grouped[emp.department] = [];\n        grouped[emp.department].push(emp);\n      });\n\n      // Sort department names alphabetically and employees within by DOJ DESC\n      Object.keys(grouped).sort().forEach(dept => {\n        grouped[dept].sort((a, b) => {\n          const dojA = new Date(a.date_of_joining?.split(\" \")[0] || \"1970-01-01\");\n          const dojB = new Date(b.date_of_joining?.split(\" \")[0] || \"1970-01-01\");\n          return dojB - dojA; // Newest first\n        });\n\n        // Add department header\n        const deptHeader = document.createElement(\"h5\");\n        deptHeader.className = \"text-primary mt-4 mb-2\";\n        deptHeader.textContent = `üè¢ ${dept || \"No Department\"}`;\n        container.appendChild(deptHeader);\n\n        // Append employee cards\n        grouped[dept].forEach(emp => {\n          const div = createEmployeeCard(emp);\n          container.appendChild(div);\n          fetchExternalWorkHistory(emp.name, div);\n        });\n      });\n    }\n  });\n\n  // Employee card creator\n  function createEmployeeCard(emp) {\n    const div = document.createElement(\"div\");\n    div.className = \"item-card\";\n    div.innerHTML = `\n      <div class=\"d-flex align-items-start\">\n        <img src=\"${emp.image || '/files/default-avatar.png'}\"\n             onerror=\"this.onerror=null;this.src='/files/default-avatar.png';\"\n             alt=\"\" class=\"employee-photo\">\n        <div class=\"flex-grow-1\">\n          <div class=\"item-header d-flex justify-content-between\">\n            <div class=\"item-title fw-bold\">${emp.employee_name}</div>\n            <div class=\"item-date\">${emp.date_of_joining?.split(\" \")[0] || \"No DOJ\"}</div>\n          </div>\n          <div class=\"item-details text-muted\">${emp.designation || \"No Designation\"}</div>\n          <div class=\"item-meta d-flex justify-content-between mt-2 mb-2\">\n            <div class=\"meta-item\">üè¢ ${emp.department || \"N/A\"}</div>\n            <div class=\"meta-item\">\n              <span class=\"badge ${emp.status === \"Active\" ? \"bg-success\" : \"bg-secondary\"}\">${emp.status}</span>\n            </div>\n          </div>\n          <div class=\"external-history\">\n            <p class=\"text-muted mb-1\"><strong>Previous Work History:</strong></p>\n            <div class=\"history-items\">Loading...</div>\n          </div>\n        </div>\n      </div>\n    `;\n    return div;\n  }\n\n  // Fetch work history\n  function fetchExternalWorkHistory(empName, div) {\n    frappe.call({\n      method: \"frappe.client.get\",\n      args: {\n        doctype: \"Employee\",\n        name: empName\n      },\n      callback: function (empFull) {\n        const doc = empFull.message;\n        const childRecords = doc.external_work_history || [];\n        const historyContainer = div.querySelector(\".history-items\");\n\n        if (childRecords.length > 0) {\n          historyContainer.innerHTML = childRecords.map(row => `\n            <div class=\"border rounded p-2 mb-1\" style=\"background-color: #f0f2f5;\">\n              <div><strong>Company:</strong> ${row.company_name}</div>\n              <div><strong>Designation:</strong> ${row.designation}</div>\n              <div><strong>Salary:</strong> ‚Çπ${row.salary}</div>\n              <div><strong>Address:</strong> ${row.address}</div>\n            </div>\n          `).join(\"\");\n        } else {\n          historyContainer.innerHTML = `<div class=\"text-muted\">No external work history found.</div>`;\n        }\n      }\n    });\n  }\n});",
  "style": ".employee-photo {\n  width: 60px;\n  height: 60px;\n  object-fit: cover;\n  border-radius: 50%;\n  border: 2px solid #ccc;\n}\n\n.item-card {\n  background-color: #f8f9fa;\n  border: 1px solid #ddd;\n  border-radius: 8px;\n  padding: 1rem;\n  margin-bottom: 1rem;\n  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.03);\n}\n\n.item-header {\n  font-size: 1rem;\n  font-weight: 600;\n  display: flex;\n  justify-content: space-between;\n}\n\n.item-title {\n  font-size: 1.1rem;\n  color: #333;\n}\n\n.item-date {\n  font-size: 0.9rem;\n  color: #888;\n}\n\n.item-details {\n  font-size: 0.95rem;\n  color: #666;\n  margin-top: 0.25rem;\n}\n\n.item-meta {\n  font-size: 0.9rem;\n  color: #555;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-top: 0.5rem;\n}\n\n.employee-photo {\n  width: 70px;\n  height: 70px;\n  object-fit: cover;\n  border-radius: 6px;\n  border: 2px solid #ccc;\n}\n\n.item-card {\n  background-color: #f8f9fa;\n  border: 1px solid #ddd;\n  border-radius: 8px;\n  padding: 1rem;\n  margin-bottom: 1rem;\n  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.03);\n}\n.employee-photo {\n  width: 100px;\n  height: 100px;\n  object-fit: cover;\n  border-radius: 50%;\n  border: 2px solid #ccc;\n  margin-right: 1.5rem;\n}\n\n.item-card {\n  background-color: #ffffff;\n  border: 1px solid #e0e0e0;\n  border-radius: 12px;\n  padding: 1.5rem;\n  margin-bottom: 1.5rem;\n  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);\n}\n\n.item-header {\n  font-size: 1rem;\n  font-weight: 600;\n  display: flex;\n  justify-content: space-between;\n}\n\n.item-title {\n  font-size: 1.2rem;\n  color: #222;\n}\n\n.item-date {\n  font-size: 0.9rem;\n  color: #666;\n}\n\n.item-details {\n  font-size: 1rem;\n  color: #444;\n  margin-top: 0.3rem;\n}\n\n.item-meta {\n  font-size: 0.9rem;\n  color: #555;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-top: 0.7rem;\n}\n\n.external-history {\n  margin-top: 1rem;\n  font-size: 0.95rem;\n}"
 }
]